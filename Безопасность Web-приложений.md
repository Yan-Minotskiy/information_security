# Безопасность Web-приложений

Что можно атковать?
Серверную часть
Клиентскую часть

Клиентские уязвимости влияют на одного пользователя.
Серверная часть влияет на всех клиентов.

Современные web-сервесы из фронтенда, который собирает данные из разных бэкендов и от полиизователя и передаёт. Разные фронтенды могу

Server-side vulnerabilities
- Логические 
- Ошибки эксплуатации
- Ошибки реализации

Логические уязвимости
- отсутствие разграничений прав доступа
- избыточная или небезопасная функциональность
- нарушение логики работы приложения

Такие уязвимости находят тестировщики. Самые удобные уязвимости для злоумышленников.

Insecure Direct Object Reference (IDOR)

- Получение денных по идентификатору в URL

Предпосылки к появлению Server-side уязвимостей
- сложности реализации (например, работа со сложными форматами)
- плохо продуманная архитектура ()
- человеческий фактор

Ошибки реализации
- инъекции и небезопасная десериализация
- гонки(race conditions)
- раскрытие информации, открытые редиректы и т. д.
- слабая криптография
- бинарные уязвимости

Инъекции и проблемы десериализации
- (No)SQL injection 
- Command injection 
- Insecure Deserialization
- XML External Entities (XXE)
- CRLF injection
- Parameter contamination
- Path traversals

Пример уязвимого к SQL инъекциям кода на Python

'''
import MySQLdb
db = MySQLdb.connect(passwd="***",db="morning")
с = db.cursor()
c.execute("""SELECT toast, jam, coffee FROM breakfast WHERE price < %s"""%max_price)
'''

'''
UNION SELECT 1, 2, version()
'''

Решение: использовать prepare statement, которые зачастую есть в современных блиотеках, использовать ORM

Не надо эскейпить.

Command injection
- Разбирать сервис на микросервис
- Не передаём пользовательский ввод в параметры
- Не запускаем новые процессы из пользовательских запросов
- Изолируем запускаемый код

Микросервисы хорошо масштабируются

Insecure Deserialization
Native форматы серриализации опасны
1. Pickle

Решение:
Использовать безопасные форматы (JSON)
Контроль целостности
Унифицируйте парсеры - разные парсеры могут по-разному интерпретировать даже JSON

Осторожно! Есть разные парсеры JSON

XML - расширяемый язык разметки

CRLF инъекции 

Path traversals
- не использовать файловую систему
- валидация пользовательского ввода

Race conditions (проблема процессов)
Можно активировать промокод 2 раза если быстро отправить запрос дважды
- использовать транзакции

Раскрытие информации и небезопасное логгирование
- заголовки запроса в ответе сервера
- ссылки на внутреннюю документацию / описание внутренних структур
- отладочные данные в prodaction
- tracebacks prodaction
- небезопасное логгирование

Слабая криптография

Что делают сотрудники отдела ИБ?
Security Review перед запуском и по запросы команды проекта
Автоматическое сканирование уязвимостей в тестовых средах и prodaction
Безопасные общие компоненты
Гайды и рекомендации